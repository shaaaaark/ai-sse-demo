# ğŸ¤– AI SSEèŠå¤©æœºå™¨äºº - å®Œæ•´å®ç°æŒ‡å—

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäº **SSE (Server-Sent Events)** æŠ€æœ¯å®ç°çš„ç°ä»£åŒ–AIèŠå¤©æœºå™¨äººæ¼”ç¤ºé¡¹ç›®ï¼Œå®Œæ•´å±•ç¤ºäº†å¦‚ä½•æ„å»ºç±»ä¼¼ChatGPTçš„æµå¼å¯¹è¯ä½“éªŒã€‚é¡¹ç›®åŒ…å«å®Œæ•´çš„å‰åç«¯å®ç°ã€Markdownæ¸²æŸ“ã€å†å²è®°å½•ç®¡ç†ç­‰ä¼ä¸šçº§åŠŸèƒ½ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ”„ **æµå¼æŠ€æœ¯**
- **SSEæµå¼å“åº”**: å®æ—¶æ¨é€AIç”Ÿæˆå†…å®¹ï¼Œæ— éœ€è½®è¯¢
- **æ‰“å­—æœºæ•ˆæœ**: é€å­—ç¬¦æ˜¾ç¤ºï¼Œæä¾›è‡ªç„¶çš„å¯¹è¯ä½“éªŒ
- **æ™ºèƒ½ç¼“å†²**: ä¼˜åŒ–å­—ç¬¦æ¨é€é¢‘ç‡ï¼Œç¡®ä¿æµç•…æ¸²æŸ“

### ğŸ¨ **ç”¨æˆ·ç•Œé¢**
- **ç°ä»£åŒ–è®¾è®¡**: ä¸“ä¸šæ‰å¹³åŒ–UIï¼Œéµå¾ªMaterial DesignåŸåˆ™
- **Markdownæ”¯æŒ**: å®Œæ•´çš„Markdownæ¸²æŸ“ï¼Œæ”¯æŒä»£ç ã€è¡¨æ ¼ã€å¼•ç”¨ç­‰
- **å“åº”å¼å¸ƒå±€**: å®Œç¾é€‚é…æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯
- **å›ºå®šé«˜åº¦**: é¡µé¢é«˜åº¦å›ºå®šï¼Œå†…å®¹è¶…å‡ºè‡ªåŠ¨æ»šåŠ¨

### ğŸ“š **åŠŸèƒ½å®Œæ•´æ€§**
- **å†å²è®°å½•**: ä¾§è¾¹æ æ˜¾ç¤ºå¯¹è¯å†å²ï¼Œæ”¯æŒé‡æ–°åŠ è½½å’Œæ¸…ç©º
- **çŠ¶æ€ç®¡ç†**: å®æ—¶è¿æ¥çŠ¶æ€æŒ‡ç¤ºå’Œé”™è¯¯å¤„ç†
- **æ¨¡æ‹ŸAI**: æ™ºèƒ½çš„æ¶ˆæ¯åŒ¹é…ç®—æ³•ï¼Œæ¼”ç¤ºä¸åŒåœºæ™¯å›å¤
- **é”™è¯¯æ¢å¤**: å®Œå–„çš„è¿æ¥æ–­å¼€æ£€æµ‹å’Œè‡ªåŠ¨é‡è¿æœºåˆ¶

## ğŸ› ï¸ æŠ€æœ¯æ ˆè¯¦è§£

### **åç«¯æ¶æ„**
```
Node.js 16+ + Express 4.18+
â”œâ”€â”€ SSE (Server-Sent Events) å®æ—¶æ¨é€
â”œâ”€â”€ CORS è·¨åŸŸæ”¯æŒ
â”œâ”€â”€ æµå¼æ•°æ®å¤„ç†
â”œâ”€â”€ æ™ºèƒ½AIæ¨¡æ‹ŸæœåŠ¡
â””â”€â”€ é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
```

### **å‰ç«¯æŠ€æœ¯**
```
ç°ä»£åŒ–WebæŠ€æœ¯æ ˆ
â”œâ”€â”€ åŸç”ŸJavaScript (ES2020+)
â”œâ”€â”€ CSS3 (å˜é‡ã€Gridã€Flexboxã€åŠ¨ç”»)
â”œâ”€â”€ EventSource API (SSEå®¢æˆ·ç«¯)
â”œâ”€â”€ Marked.js 12.0+ (Markdownè§£æ)
â””â”€â”€ æ¨¡å—åŒ–ç»„ä»¶è®¾è®¡
```

### **UI/UXè®¾è®¡**
```
è®¾è®¡ç³»ç»Ÿ
â”œâ”€â”€ è‰²å½©ç³»ç»Ÿ: è“ç´«è‰²ä¸»é¢˜ (#6366F1)
â”œâ”€â”€ å­—ä½“: Inter (Google Fonts)
â”œâ”€â”€ åŠ¨ç”»: æµç•…è¿‡æ¸¡å’Œå¾®äº¤äº’
â”œâ”€â”€ å¸ƒå±€: Flexbox + CSS Grid
â””â”€â”€ å“åº”å¼: ç§»åŠ¨ä¼˜å…ˆè®¾è®¡
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸ“‹ ç¯å¢ƒè¦æ±‚

| å·¥å…· | ç‰ˆæœ¬è¦æ±‚ | è¯´æ˜ |
|------|----------|------|
| Node.js | >= 16.0.0 | æ¨èä½¿ç”¨LTSç‰ˆæœ¬ |
| npm | >= 8.0.0 | æˆ–ä½¿ç”¨yarnã€pnpm |
| æµè§ˆå™¨ | ç°ä»£æµè§ˆå™¨ | æ”¯æŒES2020+å’ŒEventSource |

### âš¡ ä¸€é”®å¯åŠ¨

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <é¡¹ç›®åœ°å€>
cd ai-sse-demo

# 2. å®‰è£…ä¾èµ–
npm install

# 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆå¸¦çƒ­é‡è½½ï¼‰
npm run dev

# æˆ–å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm start
```

### ğŸŒ è®¿é—®åº”ç”¨

å¯åŠ¨åè®¿é—®ä»¥ä¸‹åœ°å€ï¼š

| é¡µé¢ | åœ°å€ | è¯´æ˜ |
|------|------|------|
| å®Œæ•´ç‰ˆæœ¬ | http://localhost:3000/ | åŒ…å«æ‰€æœ‰åŠŸèƒ½çš„å®Œæ•´ç•Œé¢ |
| ç®€åŒ–ç‰ˆæœ¬ | http://localhost:3000/simple.html | å•æ–‡ä»¶æµ‹è¯•ç‰ˆæœ¬ |
| å¥åº·æ£€æŸ¥ | http://localhost:3000/health | æœåŠ¡å™¨çŠ¶æ€æ£€æŸ¥ |

### âš™ï¸ ç¯å¢ƒé…ç½®

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env
```

**é…ç½®è¯´æ˜ï¼š**
```env
# åŸºç¡€é…ç½®
PORT=3000                           # æœåŠ¡å™¨ç«¯å£
NODE_ENV=development                # è¿è¡Œç¯å¢ƒ (development/production)

# AIæœåŠ¡é…ç½®ï¼ˆå¯é€‰ï¼‰
OPENAI_API_KEY=sk-xxx              # OpenAI APIå¯†é’¥
OPENAI_BASE_URL=https://api.openai.com/v1  # APIåŸºç¡€URL

# å®‰å…¨é…ç½®
CORS_ORIGIN=*                      # CORSå…è®¸çš„æº
RATE_LIMIT_WINDOW_MS=60000         # é€Ÿç‡é™åˆ¶çª—å£ï¼ˆæ¯«ç§’ï¼‰
RATE_LIMIT_MAX_REQUESTS=100        # æ¯çª—å£æœ€å¤§è¯·æ±‚æ•°

# æ—¥å¿—é…ç½®
LOG_LEVEL=info                     # æ—¥å¿—çº§åˆ« (error/warn/info/debug)
```

## ğŸ“ é¡¹ç›®æ¶æ„

```
ai-sse-demo/
â”œâ”€â”€ ğŸ“„ server.js                        # ğŸ”§ Node.jsåç«¯æœåŠ¡å™¨ (171è¡Œ)
â”œâ”€â”€ ğŸ“„ package.json                     # ğŸ“¦ é¡¹ç›®é…ç½®å’Œä¾èµ–ç®¡ç†
â”œâ”€â”€ ğŸ“„ .env.example                     # âš™ï¸ ç¯å¢ƒå˜é‡é…ç½®æ¨¡æ¿
â”œâ”€â”€ ğŸ“„ simple.html                      # ğŸ§ª ç®€åŒ–ç‰ˆæµ‹è¯•é¡µé¢
â”œâ”€â”€ ğŸ“„ README.md                        # ğŸ“– é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ ğŸ“„ SSE_AI_Chat_Knowledge_Summary.md # ğŸ“š æŠ€æœ¯çŸ¥è¯†æ€»ç»“
â”œâ”€â”€ ğŸ“ frontend/                        # ğŸ¨ å‰ç«¯èµ„æºç›®å½•
â”‚   â”œâ”€â”€ ğŸ“„ index.html                   # ğŸ  ä¸»åº”ç”¨é¡µé¢ (97è¡Œ)
â”‚   â”œâ”€â”€ ğŸ“ css/
â”‚   â”‚   â””â”€â”€ ğŸ“„ style.css                # ğŸ¨ å®Œæ•´æ ·å¼ç³»ç»Ÿ (700+è¡Œ)
â”‚   â””â”€â”€ ğŸ“ js/
â”‚       â””â”€â”€ ğŸ“„ app.js                   # âš¡ å‰ç«¯æ ¸å¿ƒé€»è¾‘ (400+è¡Œ)
```

### ğŸ”§ æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | æ ¸å¿ƒåŠŸèƒ½ | æŠ€æœ¯è¦ç‚¹ |
|------|----------|----------|
| `server.js` | SSEæœåŠ¡å™¨ | Expressè·¯ç”±ã€æµå¼å“åº”ã€AIæ¨¡æ‹Ÿ |
| `frontend/js/app.js` | å‰ç«¯æ§åˆ¶å™¨ | EventSourceã€DOMæ“ä½œã€çŠ¶æ€ç®¡ç† |
| `frontend/css/style.css` | UIæ ·å¼ç³»ç»Ÿ | CSSå˜é‡ã€Flexboxã€å“åº”å¼ |
| `simple.html` | åŠŸèƒ½æ¼”ç¤º | å•æ–‡ä»¶å®Œæ•´å®ç° |

## ğŸ”§ æŠ€æœ¯å®ç°è¯¦è§£

### ğŸš€ **SSEæµå¼å“åº”æ ¸å¿ƒ**

**æœåŠ¡å™¨ç«¯å®ç°ï¼š**
```javascript
app.get('/ai/stream', (req, res) => {
    // è®¾ç½®SSEå“åº”å¤´
    res.writeHead(200, {
        'Content-Type': 'text/event-stream',
        'Cache-Control': 'no-cache',
        'Connection': 'keep-alive',
        'Access-Control-Allow-Origin': '*',
        'X-Accel-Buffering': 'no' // ç¦ç”¨nginxç¼“å†²
    });

    // æ¨¡æ‹ŸAIé€å­—ç¬¦ç”Ÿæˆ
    const aiResponse = simulateAIResponse(userMessage);
    const chars = splitTextForStreaming(aiResponse);
    
    const streamInterval = setInterval(() => {
        if (charIndex < chars.length) {
            res.write(`data: ${JSON.stringify({ 
                type: 'content', 
                content: chars[charIndex],
                index: charIndex,
                total: chars.length 
            })}\n\n`);
            charIndex++;
        } else {
            res.write(`data: ${JSON.stringify({ type: 'done' })}\n\n`);
            clearInterval(streamInterval);
            res.end();
        }
    }, 30 + Math.random() * 50); // çœŸå®æ‰“å­—é€Ÿåº¦
});
```

**å®¢æˆ·ç«¯æ¥æ”¶ï¼š**
```javascript
class ChatApp {
    startAIStream(userMessage) {
        const url = `/ai/stream?${new URLSearchParams({message: userMessage})}`;
        this.currentEventSource = new EventSource(url);
        
        this.currentEventSource.onmessage = (event) => {
            const data = JSON.parse(event.data);
            
            switch (data.type) {
                case 'connected': this.showTypingIndicator(); break;
                case 'content': this.appendAIContent(data.content); break;
                case 'done': this.finishAIResponse(); break;
            }
        };
        
        this.currentEventSource.onerror = () => this.handleSSEError();
    }
}
```

### ğŸ“ **Markdownæ¸²æŸ“ç³»ç»Ÿ**

**å®æ—¶è§£æå’Œæ¸²æŸ“ï¼š**
```javascript
// ä½¿ç”¨marked.jsè¿›è¡ŒMarkdownè§£æ
appendAIContent(content) {
    this.currentAIMessage += content;
    const textElement = document.getElementById('current-ai-text');
    
    requestAnimationFrame(() => {
        if (typeof marked !== 'undefined') {
            textElement.innerHTML = marked.parse(this.currentAIMessage);
        } else {
            textElement.textContent = this.currentAIMessage;
        }
        this.scrollToBottom();
    });
}
```

**CSSæ ·å¼ä¼˜åŒ–ï¼š**
```css
/* Markdownå…ƒç´ æ ·å¼ */
.message-text h1, .message-text h2, .message-text h3 {
    margin: 0.5rem 0 0.25rem 0;
    font-weight: 600;
    line-height: 1.3;
}

.message-text blockquote {
    border-left: 3px solid var(--primary-color);
    background: rgba(99, 102, 241, 0.05);
    padding: 0.5rem 1rem;
}

.message-text code {
    background: rgba(0, 0, 0, 0.1);
    font-family: 'Consolas', 'Monaco', monospace;
    padding: 0.125rem 0.25rem;
    border-radius: 4px;
}
```

### ğŸ¨ **å“åº”å¼å¸ƒå±€ç³»ç»Ÿ**

**å›ºå®šé«˜åº¦è®¾è®¡ï¼š**
```css
/* æ ¸å¿ƒå¸ƒå±€ */
.app-container {
    height: 100vh;           /* å›ºå®šè§†å£é«˜åº¦ */
    display: flex;
    flex-direction: column;
    overflow: hidden;        /* é˜²æ­¢æ•´é¡µæ»šåŠ¨ */
}

.messages-container {
    flex: 1;                 /* è‡ªåŠ¨å¡«å……å‰©ä½™ç©ºé—´ */
    overflow-y: auto;        /* å†…å®¹æº¢å‡ºæ—¶æ»šåŠ¨ */
    max-height: calc(100vh - 200px); /* å‡å»å¤´éƒ¨å’Œè¾“å…¥åŒº */
}

.input-container {
    flex-shrink: 0;          /* å§‹ç»ˆå›ºå®šåœ¨åº•éƒ¨ */
}
```

**ç§»åŠ¨ç«¯é€‚é…ï¼š**
```css
@media (max-width: 768px) {
    .app-container {
        height: 100dvh;      /* åŠ¨æ€è§†å£é«˜åº¦ */
    }
    
    .messages-container {
        max-height: calc(100dvh - 160px);
        padding: 1rem;
    }
}
```

### ğŸ“š **å†å²è®°å½•ç®¡ç†**

**ä¾§è¾¹æ å®ç°ï¼š**
```javascript
// å¯¹è¯åˆ†ç»„é€»è¾‘
updateSidebarHistory() {
    const conversations = [];
    let currentConversation = [];
    
    this.messageHistory.forEach(msg => {
        if (msg.type === 'user') {
            if (currentConversation.length > 0) {
                conversations.push([...currentConversation]);
            }
            currentConversation = [msg];
        } else if (msg.type === 'ai') {
            currentConversation.push(msg);
        }
    });
    
    // æ¸²æŸ“å†å²è®°å½•åˆ—è¡¨
    this.renderHistoryList(conversations);
}

// é‡æ–°åŠ è½½å†å²å¯¹è¯
loadHistoryConversation(conversation) {
    conversation.forEach(msg => {
        if (msg.type === 'user') {
            this.addUserMessage(msg.content);
        } else {
            this.addAIMessage(msg.content);
        }
    });
}
```

### ğŸ›¡ï¸ **é”™è¯¯å¤„ç†æœºåˆ¶**

**è¿æ¥ç®¡ç†ï¼š**
```javascript
handleSSEError() {
    this.closeConnection();
    this.hideTypingIndicator();
    
    // æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
    if (this.currentMessageElement) {
        const textElement = document.getElementById('current-ai-text');
        textElement.textContent = 'è¿æ¥ä¸­æ–­ï¼Œè¯·é‡è¯•';
        textElement.style.color = 'var(--error-color)';
    }
    
    this.updateConnectionStatus('error', 'è¿æ¥é”™è¯¯');
}

// ä¼˜é›…å…³é—­è¿æ¥
closeConnection() {
    if (this.currentEventSource) {
        this.currentEventSource.close();
        this.currentEventSource = null;
    }
    this.isConnected = false;
}
```

## ğŸ¨ è®¾è®¡ç³»ç»Ÿè¯¦è§£

### ğŸ¯ **è®¾è®¡åŸåˆ™**
- **ä¸“ä¸šæ€§**: éµå¾ªMaterial Designå’ŒApple HIGè®¾è®¡æ ‡å‡†
- **ç®€æ´æ€§**: æ‰å¹³åŒ–è®¾è®¡ï¼Œçªå‡ºå†…å®¹ï¼Œå‡å°‘è§†è§‰å¹²æ‰°
- **ä¸€è‡´æ€§**: ç»Ÿä¸€çš„è‰²å½©ã€å­—ä½“ã€é—´è·å’Œç»„ä»¶ç³»ç»Ÿ
- **å¯è®¿é—®æ€§**: æ”¯æŒé”®ç›˜å¯¼èˆªï¼Œåˆç†çš„å¯¹æ¯”åº¦å’Œå­—ä½“å¤§å°

### ğŸŒˆ **è‰²å½©ç³»ç»Ÿ**
```css
:root {
    /* ä¸»è‰²è°ƒ - ç°ä»£è“ç´«è‰²ç³» */
    --primary-color: #6366F1;        /* ä¸»è‰² - æ“ä½œæŒ‰é’®ã€é“¾æ¥ */
    --primary-light: #818CF8;        /* ä¸»è‰²æµ…è‰² - æ‚¬åœçŠ¶æ€ */
    --primary-dark: #4F46E5;         /* ä¸»è‰²æ·±è‰² - æ¿€æ´»çŠ¶æ€ */
    
    /* ä¸­æ€§è‰²ç³» */
    --bg-primary: #FFFFFF;           /* ä¸»èƒŒæ™¯ - å¡ç‰‡ã€è¾“å…¥æ¡† */
    --bg-secondary: #F8FAFC;         /* æ¬¡èƒŒæ™¯ - é¡µé¢èƒŒæ™¯ */
    --bg-tertiary: #F1F5F9;          /* ä¸‰çº§èƒŒæ™¯ - AIæ¶ˆæ¯èƒŒæ™¯ */
    
    /* æ–‡å­—å±‚çº§ */
    --text-primary: #1E293B;         /* ä¸»è¦æ–‡å­— - æ ‡é¢˜ã€æ­£æ–‡ */
    --text-secondary: #64748B;       /* æ¬¡è¦æ–‡å­— - æè¿°ã€æç¤º */
    --text-muted: #94A3B8;           /* å¼±åŒ–æ–‡å­— - æ—¶é—´æˆ³ã€è¾…åŠ©ä¿¡æ¯ */
    
    /* åŠŸèƒ½è‰² */
    --success-color: #10B981;        /* æˆåŠŸçŠ¶æ€ - è¿æ¥æ­£å¸¸ */
    --warning-color: #F59E0B;        /* è­¦å‘ŠçŠ¶æ€ - è¿æ¥ä¸­ */
    --error-color: #EF4444;          /* é”™è¯¯çŠ¶æ€ - è¿æ¥å¤±è´¥ */
}
```

### ğŸ“ **å¸ƒå±€è§„èŒƒ**
```css
/* é—´è·ç³»ç»Ÿ */
--spacing-xs: 0.25rem;    /* 4px - ç´§å¯†é—´è· */
--spacing-sm: 0.5rem;     /* 8px - å°é—´è· */
--spacing-md: 1rem;       /* 16px - æ ‡å‡†é—´è· */
--spacing-lg: 1.5rem;     /* 24px - å¤§é—´è· */
--spacing-xl: 2rem;       /* 32px - è¶…å¤§é—´è· */

/* åœ†è§’ç³»ç»Ÿ */
--radius-sm: 6px;         /* å°åœ†è§’ - æŒ‰é’®ã€æ ‡ç­¾ */
--radius-md: 8px;         /* ä¸­åœ†è§’ - å¡ç‰‡ã€è¾“å…¥æ¡† */
--radius-lg: 12px;        /* å¤§åœ†è§’ - æ¶ˆæ¯æ°”æ³¡ */
--radius-xl: 16px;        /* è¶…å¤§åœ†è§’ - å®¹å™¨ */

/* é˜´å½±ç³»ç»Ÿ */
--shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
--shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
--shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
```

### âœ¨ **åŠ¨ç”»ç³»ç»Ÿ**
```css
/* è¿‡æ¸¡æ—¶é—´ */
--transition-fast: 0.15s ease;      /* å¿«é€Ÿå“åº” - æŒ‰é’®æ‚¬åœ */
--transition-normal: 0.25s ease;    /* æ ‡å‡†è¿‡æ¸¡ - é¡µé¢åˆ‡æ¢ */
--transition-slow: 0.4s ease;       /* æ…¢é€Ÿè¿‡æ¸¡ - å¤æ‚åŠ¨ç”» */

/* å…³é”®åŠ¨ç”» */
@keyframes slideInUp {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes typing {
    0%, 60%, 100% { transform: translateY(0); }
    30% { transform: translateY(-10px); }
}
```

### ğŸ–¼ï¸ **ç»„ä»¶è®¾è®¡**
- **æ¶ˆæ¯æ°”æ³¡**: åœ†è§’è®¾è®¡ï¼ŒåŒºåˆ†ç”¨æˆ·å’ŒAIæ¶ˆæ¯
- **æ‰“å­—æŒ‡ç¤ºå™¨**: ä¸‰ç‚¹è·³è·ƒåŠ¨ç”»ï¼Œæä¾›è§†è§‰åé¦ˆ
- **ä¾§è¾¹æ **: æ»‘å…¥åŠ¨ç”»ï¼Œä¸é˜»æŒ¡ä¸»å†…å®¹
- **æŒ‰é’®ç³»ç»Ÿ**: ä¸€è‡´çš„æ‚¬åœå’Œæ¿€æ´»çŠ¶æ€

## ğŸ“¡ APIæ¥å£æ–‡æ¡£

### ğŸ”„ **SSEæµå¼èŠå¤©æ¥å£**

**æ¥å£ä¿¡æ¯ï¼š**
```http
GET /ai/stream?message={ç”¨æˆ·æ¶ˆæ¯}
Content-Type: text/event-stream
Cache-Control: no-cache
Connection: keep-alive
```

**è¯·æ±‚å‚æ•°ï¼š**
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|------|
| `message` | string | âœ… | ç”¨æˆ·è¾“å…¥çš„æ¶ˆæ¯å†…å®¹ | "ä½ å¥½" |

**å“åº”äº‹ä»¶æµï¼š**

1. **è¿æ¥ç¡®è®¤äº‹ä»¶**
```json
{
    "type": "connected",
    "message": "AIæ­£åœ¨æ€è€ƒ..."
}
```

2. **å†…å®¹æµå¼ä¼ è¾“äº‹ä»¶**
```json
{
    "type": "content",
    "content": "ä½ ",           // å•ä¸ªå­—ç¬¦
    "index": 0,              // å½“å‰å­—ç¬¦ç´¢å¼•
    "total": 50              // æ€»å­—ç¬¦æ•°
}
```

3. **å®Œæˆä¿¡å·äº‹ä»¶**
```json
{
    "type": "done",
    "message": "å›å¤å®Œæˆ",
    "timestamp": "2024-01-01T12:00:00.000Z"
}
```

4. **é”™è¯¯äº‹ä»¶**
```json
{
    "type": "error",
    "error": "è¿æ¥è¶…æ—¶",
    "code": "TIMEOUT"
}
```

### ğŸ¥ **å¥åº·æ£€æŸ¥æ¥å£**

```http
GET /health
```

**å“åº”æ ¼å¼ï¼š**
```json
{
    "status": "ok",                    // æœåŠ¡çŠ¶æ€: ok | error
    "timestamp": "2024-01-01T12:00:00.000Z",
    "uptime": 3600,                    // è¿è¡Œæ—¶é—´(ç§’)
    "version": "1.0.0",                // åº”ç”¨ç‰ˆæœ¬
    "memory": {
        "used": "45.2 MB",             // å·²ä½¿ç”¨å†…å­˜
        "total": "512 MB"              // æ€»å†…å­˜
    }
}
```

### ğŸ“Š **èŠå¤©å†å²æ¥å£ (æ¨¡æ‹Ÿ)**

```http
GET /api/chat/history
```

**å“åº”æ ¼å¼ï¼š**
```json
{
    "success": true,
    "data": [
        {
            "id": 1,
            "userMessage": "ä½ å¥½",
            "aiResponse": "ä½ å¥½ï¼æˆ‘æ˜¯AIåŠ©æ‰‹...",
            "timestamp": "2024-01-01T12:00:00.000Z"
        }
    ],
    "total": 10,
    "page": 1,
    "pageSize": 20
}
```

## ğŸ¤– AIæœåŠ¡é›†æˆæŒ‡å—

### ğŸ”Œ **æ”¯æŒçš„AIæœåŠ¡**

| æœåŠ¡å•† | æ¨¡å‹ | æµå¼æ”¯æŒ | é›†æˆéš¾åº¦ | æˆæœ¬ |
|--------|------|----------|----------|------|
| **OpenAI** | GPT-3.5/4 | âœ… | ç®€å• | æŒ‰Tokenè®¡è´¹ |
| **Anthropic** | Claude | âœ… | ç®€å• | æŒ‰Tokenè®¡è´¹ |
| **Google** | Gemini | âœ… | ä¸­ç­‰ | å…è´¹é¢åº¦ |
| **æœ¬åœ°æ¨¡å‹** | Ollama | âœ… | å¤æ‚ | ç¡¬ä»¶æˆæœ¬ |

### ğŸ”§ **OpenAIé›†æˆç¤ºä¾‹**

**1. å®‰è£…ä¾èµ–ï¼š**
```bash
npm install openai
```

**2. ä¿®æ”¹server.jsï¼š**
```javascript
const { OpenAI } = require('openai');

// åˆå§‹åŒ–OpenAIå®¢æˆ·ç«¯
const openai = new OpenAI({
    apiKey: process.env.OPENAI_API_KEY,
    baseURL: process.env.OPENAI_BASE_URL || 'https://api.openai.com/v1'
});

// æ›¿æ¢æ¨¡æ‹ŸAIå“åº”å‡½æ•°
async function getAIStreamResponse(userMessage) {
    try {
        const stream = await openai.chat.completions.create({
            model: 'gpt-3.5-turbo',
            messages: [
                {
                    role: 'system',
                    content: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„AIåŠ©æ‰‹ï¼Œç”¨ä¸­æ–‡å›ç­”é—®é¢˜ã€‚'
                },
                {
                    role: 'user',
                    content: userMessage
                }
            ],
            stream: true,
            temperature: 0.7,
            max_tokens: 2000
        });
        
        return stream;
    } catch (error) {
        console.error('OpenAI APIé”™è¯¯:', error);
        throw error;
    }
}

// ä¿®æ”¹SSEè·¯ç”±
app.get('/ai/stream', async (req, res) => {
    const userMessage = req.query.message || '';
    
    // è®¾ç½®SSEå“åº”å¤´
    res.writeHead(200, {
        'Content-Type': 'text/event-stream',
        'Cache-Control': 'no-cache',
        'Connection': 'keep-alive',
        'Access-Control-Allow-Origin': '*'
    });

    try {
        const stream = await getAIStreamResponse(userMessage);
        
        for await (const chunk of stream) {
            const content = chunk.choices[0]?.delta?.content || '';
            if (content) {
                res.write(`data: ${JSON.stringify({
                    type: 'content',
                    content: content
                })}\n\n`);
            }
        }
        
        res.write(`data: ${JSON.stringify({ type: 'done' })}\n\n`);
        res.end();
        
    } catch (error) {
        res.write(`data: ${JSON.stringify({
            type: 'error',
            error: error.message
        })}\n\n`);
        res.end();
    }
});
```

**3. ç¯å¢ƒå˜é‡é…ç½®ï¼š**
```env
OPENAI_API_KEY=sk-your-openai-api-key
OPENAI_BASE_URL=https://api.openai.com/v1
```

### ğŸ  **æœ¬åœ°æ¨¡å‹é›†æˆ (Ollama)**

**1. å®‰è£…Ollamaï¼š**
```bash
# macOS
brew install ollama

# å¯åŠ¨æœåŠ¡
ollama serve

# ä¸‹è½½æ¨¡å‹
ollama pull llama2
```

**2. é›†æˆä»£ç ï¼š**
```javascript
async function getOllamaResponse(userMessage) {
    const response = await fetch('http://localhost:11434/api/generate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            model: 'llama2',
            prompt: userMessage,
            stream: true
        })
    });
    
    return response.body;
}
```

## ğŸ›¡ï¸ å®‰å…¨é˜²æŠ¤ä½“ç³»

### ğŸ”’ **è¾“å…¥éªŒè¯ä¸è¿‡æ»¤**
```javascript
// è¾“å…¥éªŒè¯ä¸­é—´ä»¶
function validateUserInput(req, res, next) {
    const { message } = req.query;
    
    // é•¿åº¦é™åˆ¶
    if (!message || message.length > 1000) {
        return res.status(400).json({
            error: 'æ¶ˆæ¯é•¿åº¦å¿…é¡»åœ¨1-1000å­—ç¬¦ä¹‹é—´'
        });
    }
    
    // æ¶æ„å†…å®¹è¿‡æ»¤
    const forbiddenPatterns = [
        /<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,
        /javascript:/gi,
        /on\w+\s*=/gi
    ];
    
    for (const pattern of forbiddenPatterns) {
        if (pattern.test(message)) {
            return res.status(400).json({
                error: 'è¾“å…¥åŒ…å«ä¸å®‰å…¨å†…å®¹'
            });
        }
    }
    
    next();
}
```

### ğŸš¦ **é€Ÿç‡é™åˆ¶ç­–ç•¥**
```javascript
const rateLimit = require('express-rate-limit');

// å…¨å±€é€Ÿç‡é™åˆ¶
const globalLimiter = rateLimit({
    windowMs: 15 * 60 * 1000,    // 15åˆ†é’Ÿ
    max: 100,                    // æ¯IPæœ€å¤š100æ¬¡è¯·æ±‚
    message: {
        error: 'è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åé‡è¯•',
        retryAfter: '15åˆ†é’Ÿ'
    },
    standardHeaders: true,
    legacyHeaders: false
});

// SSEæ¥å£ä¸“ç”¨é™åˆ¶
const sseLimit = rateLimit({
    windowMs: 60 * 1000,         // 1åˆ†é’Ÿ
    max: 10,                     // æ¯IPæœ€å¤š10æ¬¡SSEè¿æ¥
    message: { error: 'SSEè¿æ¥è¿‡äºé¢‘ç¹' }
});

app.use('/ai/stream', sseLimit);
app.use(globalLimiter);
```

### ğŸŒ **CORSå®‰å…¨é…ç½®**
```javascript
const cors = require('cors');

const corsOptions = {
    origin: function (origin, callback) {
        // ç”Ÿäº§ç¯å¢ƒç™½åå•
        const allowedOrigins = [
            'https://yourdomain.com',
            'https://app.yourdomain.com'
        ];
        
        // å¼€å‘ç¯å¢ƒå…è®¸localhost
        if (process.env.NODE_ENV === 'development') {
            allowedOrigins.push('http://localhost:3000');
        }
        
        if (!origin || allowedOrigins.includes(origin)) {
            callback(null, true);
        } else {
            callback(new Error('ä¸å…è®¸çš„è·¨åŸŸè¯·æ±‚'));
        }
    },
    credentials: true,
    optionsSuccessStatus: 200
};

app.use(cors(corsOptions));
```

### ğŸ” **æ•°æ®å®‰å…¨ä¸éšç§**
```javascript
// APIå¯†é’¥å®‰å…¨
function validateApiKey(req, res, next) {
    const apiKey = req.headers['x-api-key'];
    
    if (!apiKey || !isValidApiKey(apiKey)) {
        return res.status(401).json({
            error: 'æ— æ•ˆçš„APIå¯†é’¥'
        });
    }
    
    next();
}

// æ•æ„Ÿä¿¡æ¯è¿‡æ»¤
function sanitizeResponse(response) {
    // ç§»é™¤æ•æ„Ÿä¿¡æ¯
    return response.replace(/sk-[a-zA-Z0-9]{32,}/g, '[API_KEY_HIDDEN]');
}

// æ—¥å¿—å®‰å…¨
function secureLog(message, data = {}) {
    // é¿å…è®°å½•æ•æ„Ÿä¿¡æ¯
    const sanitizedData = {
        ...data,
        apiKey: data.apiKey ? '[HIDDEN]' : undefined,
        userMessage: data.userMessage ? 
            data.userMessage.substring(0, 50) + '...' : undefined
    };
    
    console.log(`[${new Date().toISOString()}] ${message}`, sanitizedData);
}
```

### ğŸ›¡ï¸ **é”™è¯¯å¤„ç†å®‰å…¨**
```javascript
// å…¨å±€é”™è¯¯å¤„ç†
app.use((error, req, res, next) => {
    // è®°å½•è¯¦ç»†é”™è¯¯ï¼ˆä»…æœåŠ¡å™¨ç«¯ï¼‰
    console.error('æœåŠ¡å™¨é”™è¯¯:', {
        message: error.message,
        stack: error.stack,
        url: req.url,
        method: req.method,
        ip: req.ip
    });
    
    // è¿”å›å®‰å…¨çš„é”™è¯¯ä¿¡æ¯ï¼ˆå®¢æˆ·ç«¯ï¼‰
    const isProduction = process.env.NODE_ENV === 'production';
    
    res.status(error.status || 500).json({
        success: false,
        message: isProduction ? 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯' : error.message,
        error: isProduction ? undefined : {
            type: error.name,
            details: error.message
        }
    });
});
```

## ğŸš€ éƒ¨ç½²ä¸è¿ç»´æŒ‡å—

### ğŸ—ï¸ **å¼€å‘ç¯å¢ƒéƒ¨ç½²**
```bash
# å¼€å‘æ¨¡å¼ï¼ˆçƒ­é‡è½½ï¼‰
npm run dev

# è°ƒè¯•æ¨¡å¼
DEBUG=* npm run dev

# æŒ‡å®šç«¯å£
PORT=8080 npm run dev
```

### ğŸŒ **ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²**

**1. ä¼ ç»Ÿéƒ¨ç½²ï¼š**
```bash
# å®‰è£…ç”Ÿäº§ä¾èµ–
npm ci --only=production

# å¯åŠ¨åº”ç”¨
NODE_ENV=production npm start

# ä½¿ç”¨PM2ç®¡ç†è¿›ç¨‹
npm install -g pm2
pm2 start server.js --name "ai-chat"
pm2 save
pm2 startup
```

**2. Dockeréƒ¨ç½²ï¼š**
```dockerfile
# Dockerfile
FROM node:18-alpine

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY package*.json ./

# å®‰è£…ä¾èµ–
RUN npm ci --only=production && npm cache clean --force

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY . .

# åˆ›å»ºérootç”¨æˆ·
RUN addgroup -g 1001 -S nodejs
RUN adduser -S nodejs -u 1001
USER nodejs

# æš´éœ²ç«¯å£
EXPOSE 3000

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:3000/health || exit 1

# å¯åŠ¨åº”ç”¨
CMD ["node", "server.js"]
```

**docker-compose.ymlï¼š**
```yaml
version: '3.8'
services:
  ai-chat:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - PORT=3000
    restart: unless-stopped
    volumes:
      - ./logs:/app/logs
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
```

### â˜ï¸ **äº‘å¹³å°éƒ¨ç½²**

**Verceléƒ¨ç½²ï¼š**
```json
// vercel.json
{
  "version": 2,
  "builds": [
    {
      "src": "server.js",
      "use": "@vercel/node"
    },
    {
      "src": "frontend/**/*",
      "use": "@vercel/static"
    }
  ],
  "routes": [
    {
      "src": "/ai/(.*)",
      "dest": "/server.js"
    },
    {
      "src": "/(.*)",
      "dest": "/frontend/$1"
    }
  ]
}
```

**Railwayéƒ¨ç½²ï¼š**
```toml
# railway.toml
[build]
builder = "NIXPACKS"

[deploy]
startCommand = "npm start"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[env]
NODE_ENV = "production"
```

### ğŸ“Š **ç›‘æ§ä¸æ—¥å¿—**

**æ€§èƒ½ç›‘æ§ï¼š**
```javascript
// æ·»åŠ æ€§èƒ½ç›‘æ§
const prometheus = require('prom-client');

// åˆ›å»ºæŒ‡æ ‡
const httpRequestDuration = new prometheus.Histogram({
    name: 'http_request_duration_seconds',
    help: 'Duration of HTTP requests in seconds',
    labelNames: ['method', 'route', 'status']
});

const activeConnections = new prometheus.Gauge({
    name: 'sse_active_connections',
    help: 'Number of active SSE connections'
});

// ä¸­é—´ä»¶
app.use((req, res, next) => {
    const start = Date.now();
    
    res.on('finish', () => {
        const duration = (Date.now() - start) / 1000;
        httpRequestDuration
            .labels(req.method, req.route?.path || req.path, res.statusCode)
            .observe(duration);
    });
    
    next();
});

// æŒ‡æ ‡æ¥å£
app.get('/metrics', async (req, res) => {
    res.set('Content-Type', prometheus.register.contentType);
    res.end(await prometheus.register.metrics());
});
```

**æ—¥å¿—ç³»ç»Ÿï¼š**
```javascript
const winston = require('winston');

const logger = winston.createLogger({
    level: process.env.LOG_LEVEL || 'info',
    format: winston.format.combine(
        winston.format.timestamp(),
        winston.format.errors({ stack: true }),
        winston.format.json()
    ),
    transports: [
        new winston.transports.File({ 
            filename: 'logs/error.log', 
            level: 'error' 
        }),
        new winston.transports.File({ 
            filename: 'logs/combined.log' 
        })
    ]
});

if (process.env.NODE_ENV !== 'production') {
    logger.add(new winston.transports.Console({
        format: winston.format.simple()
    }));
}
```

## ğŸ¯ **æ€§èƒ½æŒ‡æ ‡ä¸ç›‘æ§**

### ğŸ“Š **å…³é”®æŒ‡æ ‡**
| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å½“å‰å€¼ | è¯´æ˜ |
|------|--------|--------|------|
| é¦–å±åŠ è½½æ—¶é—´ | < 2s | ~1.5s | é¡µé¢å®Œå…¨å¯äº¤äº’æ—¶é—´ |
| SSEè¿æ¥å»ºç«‹ | < 500ms | ~300ms | ä»è¯·æ±‚åˆ°æ¥æ”¶é¦–ä¸ªäº‹ä»¶ |
| å­—ç¬¦æ¸²æŸ“å»¶è¿Ÿ | < 50ms | ~30ms | å•å­—ç¬¦æ˜¾ç¤ºå»¶è¿Ÿ |
| å†…å­˜ä½¿ç”¨ | < 100MB | ~45MB | é•¿æ—¶é—´ä½¿ç”¨åçš„å†…å­˜å ç”¨ |
| CPUä½¿ç”¨ç‡ | < 5% | ~2% | ç©ºé—²çŠ¶æ€ä¸‹çš„CPUå ç”¨ |

### ğŸ” **ç›‘æ§é¢æ¿**
```javascript
// åˆ›å»ºæ€§èƒ½ç›‘æ§é¢æ¿
class PerformanceMonitor {
    constructor() {
        this.metrics = {
            messageCount: 0,
            averageRenderTime: 0,
            memoryUsage: 0,
            connectionUptime: 0
        };
        this.startTime = Date.now();
    }
    
    recordMessageRender(duration) {
        this.metrics.messageCount++;
        this.metrics.averageRenderTime = 
            (this.metrics.averageRenderTime * (this.metrics.messageCount - 1) + duration) 
            / this.metrics.messageCount;
    }
    
    getReport() {
        return {
            ...this.metrics,
            uptime: Date.now() - this.startTime,
            memoryUsage: this.getMemoryUsage()
        };
    }
}
```

## ğŸ¤ **è´¡çŒ®æŒ‡å—**

### ğŸ“‹ **å¼€å‘æµç¨‹**
```bash
# 1. Fork å¹¶å…‹éš†é¡¹ç›®
git clone https://github.com/yourusername/ai-sse-demo.git
cd ai-sse-demo

# 2. å®‰è£…ä¾èµ–
npm install

# 3. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/amazing-feature

# 4. å¼€å‘å’Œæµ‹è¯•
npm run dev
npm test

# 5. æäº¤æ›´æ”¹
git add .
git commit -m "feat: æ·»åŠ ä»¤äººæƒŠå¹çš„æ–°åŠŸèƒ½"

# 6. æ¨é€åˆ†æ”¯
git push origin feature/amazing-feature

# 7. åˆ›å»º Pull Request
```

### ğŸ“ **ä»£ç è§„èŒƒ**
- **JavaScript**: ä½¿ç”¨ES2020+è¯­æ³•ï¼Œéµå¾ªESLintè§„åˆ™
- **CSS**: ä½¿ç”¨BEMå‘½åè§„èŒƒï¼Œä¿æŒæ ·å¼æ¨¡å—åŒ–
- **æäº¤ä¿¡æ¯**: éµå¾ª[Conventional Commits](https://conventionalcommits.org/)è§„èŒƒ
- **æ–‡æ¡£**: æ‰€æœ‰æ–°åŠŸèƒ½å¿…é¡»åŒ…å«ç›¸åº”æ–‡æ¡£

### ğŸ§ª **æµ‹è¯•è¦æ±‚**
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•
npm run test:e2e

# è¿è¡Œæ€§èƒ½æµ‹è¯•
npm run test:performance

# ä»£ç è¦†ç›–ç‡
npm run test:coverage
```

### ğŸ“‹ **Pull Requestæ£€æŸ¥æ¸…å•**
- [ ] ä»£ç é€šè¿‡æ‰€æœ‰æµ‹è¯•
- [ ] æ–°åŠŸèƒ½åŒ…å«æµ‹è¯•ç”¨ä¾‹
- [ ] æ›´æ–°äº†ç›¸å…³æ–‡æ¡£
- [ ] éµå¾ªé¡¹ç›®ä»£ç è§„èŒƒ
- [ ] æ²¡æœ‰å¼•å…¥å®‰å…¨æ¼æ´
- [ ] æ€§èƒ½å½±å“åœ¨å¯æ¥å—èŒƒå›´å†…

## ğŸ“„ **è®¸å¯è¯ä¸ç‰ˆæƒ**

æœ¬é¡¹ç›®é‡‡ç”¨ **MIT è®¸å¯è¯** å¼€æºã€‚

```
MIT License

Copyright (c) 2024 AI SSE Chat Demo

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
```

## ğŸ“§ **è”ç³»æ–¹å¼ä¸æ”¯æŒ**

### ğŸ”— **ç›¸å…³é“¾æ¥**
- [é¡¹ç›®ä¸»é¡µ](https://github.com/yourusername/ai-sse-demo)
- [åœ¨çº¿æ¼”ç¤º](https://ai-sse-demo.vercel.app)
- [æŠ€æœ¯æ–‡æ¡£](https://github.com/yourusername/ai-sse-demo/wiki)
- [æ›´æ–°æ—¥å¿—](https://github.com/yourusername/ai-sse-demo/releases)

### ğŸ’¬ **è·å–å¸®åŠ©**
- ğŸ› [æŠ¥å‘ŠBug](https://github.com/yourusername/ai-sse-demo/issues/new?template=bug_report.md)
- ğŸ’¡ [åŠŸèƒ½å»ºè®®](https://github.com/yourusername/ai-sse-demo/issues/new?template=feature_request.md)
- ğŸ“– [æ–‡æ¡£æ”¹è¿›](https://github.com/yourusername/ai-sse-demo/issues/new?template=documentation.md)
- ğŸ’­ [è®¨è®ºäº¤æµ](https://github.com/yourusername/ai-sse-demo/discussions)

### ğŸŒŸ **è‡´è°¢**
æ„Ÿè°¢æ‰€æœ‰ä¸ºè¿™ä¸ªé¡¹ç›®åšå‡ºè´¡çŒ®çš„å¼€å‘è€…ä»¬ï¼

---

<div align="center">

**ğŸ‰ äº«å—ä½¿ç”¨ AI SSE èŠå¤©æœºå™¨äººï¼**

å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª â­ï¸ æ”¯æŒä¸€ä¸‹ï¼

[â¬†ï¸ å›åˆ°é¡¶éƒ¨](#-ai-sseèŠå¤©æœºå™¨äºº---å®Œæ•´å®ç°æŒ‡å—)

</div>

## â“ å¸¸è§é—®é¢˜ä¸æ•…éšœæ’é™¤

### ğŸ”§ **è¿æ¥é—®é¢˜**

**Q: SSEè¿æ¥å¤±è´¥ï¼Œæ˜¾ç¤º"è¿æ¥é”™è¯¯"**
```bash
# æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
curl http://localhost:3000/health

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep :3000
lsof -i :3000

# é‡å¯æœåŠ¡
npm run dev
```

**A: è§£å†³æ–¹æ¡ˆ**
1. ç¡®è®¤æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ
2. æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦é˜»æ­¢ç«¯å£
3. éªŒè¯CORSé…ç½®æ˜¯å¦æ­£ç¡®
4. æŸ¥çœ‹æœåŠ¡å™¨é”™è¯¯æ—¥å¿—

**Q: è¿æ¥é¢‘ç¹æ–­å¼€**
```javascript
// æ·»åŠ è¿æ¥ä¿æ´»æœºåˆ¶
setInterval(() => {
    if (this.currentEventSource && this.currentEventSource.readyState === EventSource.OPEN) {
        // å‘é€å¿ƒè·³æ£€æµ‹
        console.log('SSEè¿æ¥æ­£å¸¸');
    }
}, 30000);
```

### ğŸ¨ **ç•Œé¢é—®é¢˜**

**Q: æ‰“å­—æœºæ•ˆæœä¸æµç•…æˆ–å¡é¡¿**
```javascript
// æ£€æŸ¥æ¸²æŸ“æ€§èƒ½
console.time('markdown-render');
textElement.innerHTML = marked.parse(this.currentAIMessage);
console.timeEnd('markdown-render');

// ä¼˜åŒ–æ–¹æ¡ˆï¼šå‡å°‘DOMæ“ä½œé¢‘ç‡
const RENDER_INTERVAL = 50; // 50ms
let renderTimeout;

appendAIContent(content) {
    this.currentAIMessage += content;
    
    if (renderTimeout) clearTimeout(renderTimeout);
    renderTimeout = setTimeout(() => {
        this.renderMessage();
    }, RENDER_INTERVAL);
}
```

**Q: ç§»åŠ¨ç«¯æ˜¾ç¤ºå¼‚å¸¸æˆ–å¸ƒå±€é”™ä¹±**
```css
/* æ£€æŸ¥è§†å£è®¾ç½® */
@media (max-width: 768px) {
    .app-container {
        height: 100dvh; /* åŠ¨æ€è§†å£é«˜åº¦ */
    }
}

/* ç¡®ä¿å­—ä½“å¤§å°é€‚é… */
@media (max-width: 480px) {
    html {
        font-size: 14px; /* åŸºç¡€å­—ä½“ç¼©å° */
    }
}
```

**Q: æ»šåŠ¨æ¡ä¸å‡ºç°æˆ–æ»šåŠ¨å¼‚å¸¸**
```css
/* å¼ºåˆ¶æ˜¾ç¤ºæ»šåŠ¨æ¡ */
.messages-container {
    overflow-y: scroll !important;
    max-height: calc(100vh - 200px);
}

/* WebKitæµè§ˆå™¨æ»šåŠ¨æ¡æ ·å¼ */
.messages-container::-webkit-scrollbar {
    width: 6px;
    display: block;
}
```

### ğŸ¤– **AIå“åº”é—®é¢˜**

**Q: AIå›å¤å†…å®¹æ˜¾ç¤ºä¹±ç æˆ–æ ¼å¼é”™è¯¯**
```javascript
// æ£€æŸ¥ç¼–ç é—®é¢˜
function ensureUTF8(str) {
    try {
        return new TextDecoder('utf-8').decode(new TextEncoder().encode(str));
    } catch (e) {
        console.error('ç¼–ç è½¬æ¢å¤±è´¥:', e);
        return str;
    }
}

// Markdownè§£æé”™è¯¯å¤„ç†
try {
    textElement.innerHTML = marked.parse(this.currentAIMessage);
} catch (error) {
    console.error('Markdownè§£æå¤±è´¥:', error);
    textElement.textContent = this.currentAIMessage; // é™çº§ä¸ºçº¯æ–‡æœ¬
}
```

**Q: æ¨¡æ‹ŸAIå›å¤ä¸æ™ºèƒ½æˆ–é‡å¤**
```javascript
// å¢å¼ºAIå›å¤é€»è¾‘
function generateContextualResponse(userMessage, conversationHistory) {
    const context = conversationHistory.slice(-3); // è€ƒè™‘æœ€è¿‘3è½®å¯¹è¯
    
    // åŸºäºä¸Šä¸‹æ–‡ç”Ÿæˆå›å¤
    if (context.some(msg => msg.content.includes('ä»£ç '))) {
        return generateCodeRelatedResponse(userMessage);
    }
    
    return generateGeneralResponse(userMessage);
}
```

### ğŸ“± **æ€§èƒ½ä¼˜åŒ–**

**Q: é¡µé¢åŠ è½½ç¼“æ…¢æˆ–å†…å­˜å ç”¨è¿‡é«˜**
```javascript
// å†…å­˜æ³„æ¼æ£€æµ‹
function checkMemoryLeaks() {
    if (window.performance && window.performance.memory) {
        const memory = window.performance.memory;
        console.log('å†…å­˜ä½¿ç”¨:', {
            used: `${(memory.usedJSHeapSize / 1024 / 1024).toFixed(2)} MB`,
            total: `${(memory.totalJSHeapSize / 1024 / 1024).toFixed(2)} MB`,
            limit: `${(memory.jsHeapSizeLimit / 1024 / 1024).toFixed(2)} MB`
        });
    }
}

// æ¸…ç†å†å²æ¶ˆæ¯ï¼ˆé¿å…DOMèŠ‚ç‚¹è¿‡å¤šï¼‰
function cleanupOldMessages() {
    const messages = this.elements.messagesContainer.querySelectorAll('.message');
    if (messages.length > 100) {
        // ä¿ç•™æœ€è¿‘50æ¡æ¶ˆæ¯
        for (let i = 0; i < messages.length - 50; i++) {
            messages[i].remove();
        }
    }
}
```

**Q: SSEè¿æ¥æ•°è¿‡å¤šå¯¼è‡´æœåŠ¡å™¨å‹åŠ›**
```javascript
// æœåŠ¡å™¨ç«¯è¿æ¥ç®¡ç†
const activeConnections = new Set();
const MAX_CONNECTIONS = 100;

app.get('/ai/stream', (req, res) => {
    if (activeConnections.size >= MAX_CONNECTIONS) {
        return res.status(429).json({
            error: 'æœåŠ¡å™¨ç¹å¿™ï¼Œè¯·ç¨åé‡è¯•'
        });
    }
    
    activeConnections.add(res);
    
    req.on('close', () => {
        activeConnections.delete(res);
    });
});
```

### ğŸ› **è°ƒè¯•å·¥å…·å’ŒæŠ€å·§**

**æµè§ˆå™¨è°ƒè¯•ï¼š**
```javascript
// å¼€å¯è¯¦ç»†æ—¥å¿—
localStorage.setItem('debug', 'ai-chat:*');

// SSEè¿æ¥çŠ¶æ€ç›‘æ§
function monitorSSEConnection(eventSource) {
    console.log('SSEçŠ¶æ€:', {
        readyState: eventSource.readyState,
        url: eventSource.url
    });
    
    eventSource.addEventListener('open', () => {
        console.log('SSEè¿æ¥å·²æ‰“å¼€');
    });
    
    eventSource.addEventListener('error', (e) => {
        console.error('SSEè¿æ¥é”™è¯¯:', e);
    });
}
```

**æœåŠ¡å™¨è°ƒè¯•ï¼š**
```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
DEBUG=express:* npm run dev

# ç›‘æ§ç½‘ç»œè¿æ¥
netstat -an | grep :3000

# æŸ¥çœ‹è¿›ç¨‹èµ„æºä½¿ç”¨
ps aux | grep node
top -p $(pgrep node)
```

**æ€§èƒ½åˆ†æï¼š**
```javascript
// å‰ç«¯æ€§èƒ½ç›‘æ§
function measurePerformance() {
    const observer = new PerformanceObserver((list) => {
        list.getEntries().forEach((entry) => {
            console.log(`${entry.name}: ${entry.duration}ms`);
        });
    });
    
    observer.observe({ entryTypes: ['measure', 'navigation'] });
}

// å…³é”®æŒ‡æ ‡æµ‹é‡
performance.mark('sse-start');
// ... SSEæ“ä½œ ...
performance.mark('sse-end');
performance.measure('sse-duration', 'sse-start', 'sse-end');
```

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿è”ç³»ï¼š
- æäº¤Issue
- å‘é€é‚®ä»¶
- åˆ›å»ºDiscussion

---

**äº«å—ä½¿ç”¨AI SSEèŠå¤©æœºå™¨äººï¼** ğŸ¤–âœ¨ 